<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Discopolia Online üåê</title>
  <style>
    body { margin:0; font-family:'Arial',sans-serif; background:#111; color:#fff; text-align:center;}
    header { background:linear-gradient(45deg,#ff0066,#ffcc00,#00ffcc); padding:2rem; animation:gradientShift 5s ease infinite; background-size:300% 300%;}
    header h1 { margin:0; font-size:3rem; text-shadow:2px 2px 5px #000;}
    header p { font-size:1.2rem; text-shadow:1px 1px 3px #000;}
    @keyframes gradientShift {0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}
    main { max-width:900px; margin:2rem auto; padding:0 1rem;}
    section { background:rgba(255,255,255,0.05); padding:2rem; margin-bottom:2rem; border-radius:15px; box-shadow:0 0 15px #ff0066;}
    h2 { color:#ffcc00; text-shadow:1px 1px 5px #000;}
    .mandaty { background:#ff0066; padding:1rem; border-radius:10px; font-weight:bold; cursor:pointer; margin:1rem 0; box-shadow:0 0 10px #ff0066; transition:0.2s;}
    .mandaty:hover { transform:scale(1.1);}
    .btn { background:#ff0066; border:none; color:#fff; padding:10px 20px; border-radius:10px; cursor:pointer; box-shadow:0 0 10px #ff0066; transition:0.3s;}
    .btn:hover { background:#ffcc00; color:#111;}
    input { padding:6px; border-radius:6px; border:none; margin:0 5px;}
    .law { background:rgba(255,255,255,0.05); margin:0.5rem 0; padding:0.5rem; border-radius:8px; text-align:left;}
  </style>
</head>
<body>
  <header>
    <h1>Discopolia Online</h1>
    <p>Globalne Mandaty Zenkowe üé∂</p>
  </header>

  <main>
    <section>
      <h2>üí∏ Mandaty</h2>
      <div id="mandatBox" class="mandaty">Kliknij, aby zdobyƒá mandat!</div>
      <p>Twoje mandaty: <span id="mandatCount">0</span> MZ</p>
      <p id="bonusInfo" style="color:#00ffcc; font-weight:bold;">Brak aktywnego bonusu</p>
      <p>üåç Globalne mandaty: <span id="globalCount">0</span> MZ</p>
    </section>

    <section>
      <h2>üèõÔ∏è Obywatelstwo</h2>
      <input id="citizenName" placeholder="Twoje imiƒô">
      <button id="joinBtn" class="btn">Zosta≈Ñ obywatelem</button>
      <div id="citizensList"></div>
    </section>

    <section>
      <h2>üìú Ustawy</h2>
      <input id="lawName" placeholder="Nazwa ustawy">
      <input id="lawDesc" placeholder="Opis">
      <button id="addLawBtn" class="btn">Zaproponuj (500 MZ)</button>
      <div id="lawsList"></div>
    </section>
  </main>

  <script>
    /* === KONFIGURACJA JSONBIN === */
    const BIN_ID = "TUTAJ_WKLEJ_BIN_ID";
    const API_KEY = "TUTAJ_WKLEJ_MASTER_KEY";
    const BIN_URL = `https://api.jsonbin.io/v3/b/${BIN_ID}`;

    /* === FUNKCJE JSONBIN === */
    async function loadBin() {
      const res = await fetch(BIN_URL, { headers: { "X-Master-Key": API_KEY }});
      const data = await res.json();
      return data.record;
    }

    async function saveBin(data) {
      await fetch(BIN_URL, {
        method: "PUT",
        headers: { "Content-Type": "application/json", "X-Master-Key": API_KEY },
        body: JSON.stringify(data)
      });
    }

    async function modifyBin(fn) {
      const state = await loadBin();
      await fn(state);
      await saveBin(state);
      return await loadBin();
    }

    /* === ZMIENNE === */
    let localMandaty = 0;
    const mandatBox = document.getElementById("mandatBox");
    const localCount = document.getElementById("mandatCount");
    const globalCount = document.getElementById("globalCount");

    /* === FUNKCJE MANDAT√ìW === */
    async function addMandaty(amount) {
      localMandaty += amount;
      localCount.textContent = localMandaty;

      await modifyBin(s => {
        s.globalMandaty = (s.globalMandaty || 0) + amount;
      });
      await updateGlobal();
    }

    async function updateGlobal() {
      const s = await loadBin();
      globalCount.textContent = s.globalMandaty || 0;
      renderCitizens(s.citizens);
      renderLaws(s.laws);
    }

    mandatBox.onclick = () => addMandaty(1);

    /* === OBYWATELE === */
    const joinBtn = document.getElementById("joinBtn");
    const citizenInput = document.getElementById("citizenName");
    const citizensList = document.getElementById("citizensList");

    joinBtn.onclick = async () => {
      const name = citizenInput.value.trim();
      if (!name) return alert("Podaj imiƒô!");
      await modifyBin(s => {
        s.citizens = s.citizens || [];
        if (!s.citizens.find(c => c.name === name)) s.citizens.push({ name, score: 0 });
      });
      updateGlobal();
    };

    function renderCitizens(list = []) {
      citizensList.innerHTML = "<h3>Obywatele:</h3>" + list.map(c => `${c.name} (${c.score} MZ)`).join("<br>");
    }

    /* === USTAWY === */
    const lawName = document.getElementById("lawName");
    const lawDesc = document.getElementById("lawDesc");
    const addLawBtn = document.getElementById("addLawBtn");
    const lawsList = document.getElementById("lawsList");

    addLawBtn.onclick = async () => {
      if (localMandaty < 500) return alert("Potrzebujesz 500 MZ!");
      const name = lawName.value.trim();
      const desc = lawDesc.value.trim();
      if (!name || !desc) return alert("Uzupe≈Çnij nazwƒô i opis!");
      localMandaty -= 500;
      localCount.textContent = localMandaty;

      await modifyBin(s => {
        s.laws = s.laws || [];
        s.laws.push({ id: "law_" + Date.now(), name, desc, votes: 0 });
        s.globalMandaty -= 500;
      });
      updateGlobal();
    };

    async function voteLaw(id) {
      await modifyBin(s => {
        const l = s.laws.find(x => x.id === id);
        if (l) l.votes += 1;
      });
      updateGlobal();
    }

    function renderLaws(list = []) {
      lawsList.innerHTML = list.map(l => `
        <div class="law">
          <strong>${l.name}</strong> (${l.votes} g≈Ços√≥w)<br>${l.desc}<br>
          <button onclick="voteLaw('${l.id}')">G≈Çosuj</button>
        </div>`).join("");
    }

    /* === START === */
    updateGlobal();
  </script>
</body>
</html>
